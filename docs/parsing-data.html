<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Parsing data | Harvesting Rental Data and Assessing Rental Crisis in Sydney</title>
  <meta name="description" content="Working on making a book using rental data" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Parsing data | Harvesting Rental Data and Assessing Rental Crisis in Sydney" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Working on making a book using rental data" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Parsing data | Harvesting Rental Data and Assessing Rental Crisis in Sydney" />
  
  <meta name="twitter:description" content="Working on making a book using rental data" />
  

<meta name="author" content="Dr. Chinh Ho" />


<meta name="date" content="2024-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="setup.html"/>
<link rel="next" href="write.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mini Bookdown Tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#learn-all-about-bookdown"><i class="fa fa-check"></i><b>1.1</b> Learn all about Bookdown</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> Setting up Bookdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="setup.html"><a href="setup.html#get-bookdown-tutorial-going-on-your-local-computer"><i class="fa fa-check"></i><b>2.1</b> Get “bookdown-tutorial” going on your local computer</a></li>
<li class="chapter" data-level="2.2" data-path="setup.html"><a href="setup.html#create-your-awesome-book-github-repo"><i class="fa fa-check"></i><b>2.2</b> Create your “awesome-book” GitHub repo</a></li>
<li class="chapter" data-level="2.3" data-path="setup.html"><a href="setup.html#turn-bookdown-tutorial-into-awesome-book"><i class="fa fa-check"></i><b>2.3</b> Turn “bookdown-tutorial” into “awesome-book”</a></li>
<li class="chapter" data-level="2.4" data-path="setup.html"><a href="setup.html#publish-awesome-book"><i class="fa fa-check"></i><b>2.4</b> Publish “awesome-book”</a></li>
<li class="chapter" data-level="2.5" data-path="setup.html"><a href="setup.html#moving-forward"><i class="fa fa-check"></i><b>2.5</b> Moving forward</a></li>
<li class="chapter" data-level="2.6" data-path="setup.html"><a href="setup.html#this-is-to-test-if-it-works"><i class="fa fa-check"></i><b>2.6</b> This is to test if it works</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="parsing-data.html"><a href="parsing-data.html"><i class="fa fa-check"></i><b>3</b> Parsing data</a></li>
<li class="chapter" data-level="4" data-path="write.html"><a href="write.html"><i class="fa fa-check"></i><b>4</b> Writing in Bookdown</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Harvesting Rental Data and Assessing Rental Crisis in Sydney</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="parsing-data" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Parsing data<a href="parsing-data.html#parsing-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The first thing we have to do is to combine the Excel files downloaded from the website. We then need to parse the data and tidy it up in a format that is ready for analysis. We use a <code>for</code> loop to go through all files and read them, then bind them together in one <code>dataframe</code>. The <code>for</code> loop approach is used so that we can add a field/column to indicate the period of the data (i.e., which quarter and year the data represents).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="parsing-data.html#cb2-1" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(tidyverse)){</span>
<span id="cb2-2"><a href="parsing-data.html#cb2-2" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)} <span class="co"># check and install &#39;tidyverse&#39; if needed </span></span></code></pre></div>
<pre><code>## Loading required package: tidyverse</code></pre>
<pre><code>## Warning: replacing previous import &#39;lifecycle::last_warnings&#39; by
## &#39;rlang::last_warnings&#39; when loading &#39;pillar&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;lifecycle::last_warnings&#39; by
## &#39;rlang::last_warnings&#39; when loading &#39;tibble&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;lifecycle::last_warnings&#39; by
## &#39;rlang::last_warnings&#39; when loading &#39;hms&#39;</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.4     v dplyr   1.0.7
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   2.0.1     v forcats 0.5.1</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="parsing-data.html#cb10-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># load required package</span></span>
<span id="cb10-2"><a href="parsing-data.html#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="parsing-data.html#cb10-3" tabindex="-1"></a>sfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;./RentData&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="co"># list all files </span></span>
<span id="cb10-4"><a href="parsing-data.html#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="parsing-data.html#cb10-5" tabindex="-1"></a>colnm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;postcode&quot;</span>, <span class="st">&quot;dwt&quot;</span>, <span class="st">&quot;beds&quot;</span>, <span class="st">&quot;wklyrent_q1&quot;</span>,<span class="st">&quot;wklyrent_q2&quot;</span>,<span class="st">&quot;wklyrent_q3&quot;</span>, </span>
<span id="cb10-6"><a href="parsing-data.html#cb10-6" tabindex="-1"></a>           <span class="st">&quot;newbonds&quot;</span>,<span class="st">&quot;bondnum&quot;</span>, <span class="st">&quot;rentchgqrt&quot;</span>,<span class="st">&quot;rentchgann&quot;</span>, <span class="st">&quot;bondchgqrt&quot;</span>,<span class="st">&quot;bondchgann&quot;</span>)</span>
<span id="cb10-7"><a href="parsing-data.html#cb10-7" tabindex="-1"></a><span class="co"># loop through each file to read and bind them together</span></span>
<span id="cb10-8"><a href="parsing-data.html#cb10-8" tabindex="-1"></a>res <span class="ot">&lt;-</span> temp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-9"><a href="parsing-data.html#cb10-9" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(sfiles)){</span>
<span id="cb10-10"><a href="parsing-data.html#cb10-10" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(sfiles[i], <span class="at">sheet =</span> <span class="dv">3</span>, </span>
<span id="cb10-11"><a href="parsing-data.html#cb10-11" tabindex="-1"></a>                              <span class="at">col_names =</span> colnm,  <span class="at">skip =</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="parsing-data.html#cb10-12" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">unlist</span>(sfiles[i])) <span class="co"># add the file name to know which quarter</span></span>
<span id="cb10-13"><a href="parsing-data.html#cb10-13" tabindex="-1"></a>    </span>
<span id="cb10-14"><a href="parsing-data.html#cb10-14" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(res, temp)</span>
<span id="cb10-15"><a href="parsing-data.html#cb10-15" tabindex="-1"></a>}</span>
<span id="cb10-16"><a href="parsing-data.html#cb10-16" tabindex="-1"></a><span class="fu">rm</span>(temp) <span class="co"># remove temp file which is no longer needed.</span></span></code></pre></div>
<p>Before proceeding to data tidying, we need to check the data structure and data types to see if the loop above read the data in correctly. We use the <code>dplyr::head</code> function to show the first 6 rows in the <code>dataframe</code>. We can see that many fields have a wrong data type (character instead of double). We will change them before formatting it into a so-called <code>tidy</code> format.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="parsing-data.html#cb11-1" tabindex="-1"></a>res <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="parsing-data.html#cb11-2" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##   postcode dwt       beds   wklyrent_q1 wklyrent_q2 wklyrent_q3 newbonds bondnum
##      &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;  
## 1     1790 Flat/Unit 2 Bed~ -           -           -           -        -      
## 2     1825 Total     Total  -           -           -           -        -      
## 3     1825 Total     2 Bed~ -           -           -           -        -      
## 4     1825 Other     Total  -           -           -           -        -      
## 5     1825 Other     2 Bed~ -           -           -           -        -      
## 6     1860 Total     Total  -           -           -           -        -      
## # ... with 5 more variables: rentchgqrt &lt;chr&gt;, rentchgann &lt;chr&gt;,
## #   bondchgqrt &lt;chr&gt;, bondchgann &lt;chr&gt;, period &lt;chr&gt;</code></pre>
<p>Use <code>mutate</code> and <code>across</code> functions to convert the data type for multiple fields at once. We convert from character to numeric type. We then use pattern matching to parse the file name and get the corresponding texts that indicate the quarter and the year of the data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="parsing-data.html#cb13-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="parsing-data.html#cb13-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(wklyrent_q1<span class="sc">:</span>bondchgann, <span class="sc">~</span> <span class="fu">as.numeric</span>(.)))</span></code></pre></div>
<pre><code>## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="parsing-data.html#cb15-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="parsing-data.html#cb15-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;^./Issue-</span><span class="sc">\\</span><span class="st">d{3}-&quot;</span>, <span class="st">&quot;&quot;</span>,<span class="at">ignore.case =</span> T,period)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="parsing-data.html#cb15-3" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;-?./?Rent-tables-&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="at">ignore.case =</span> T,  period)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="parsing-data.html#cb15-4" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;-Quarter&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="at">ignore.case =</span> T, period)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="parsing-data.html#cb15-5" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.xlsx$&quot;</span>, <span class="st">&quot;&quot;</span>, period)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="parsing-data.html#cb15-6" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;./Issue&quot;</span>, <span class="st">&quot;&quot;</span>,<span class="at">ignore.case =</span> T,period)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="parsing-data.html#cb15-7" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;./RentDat|./RentDat-</span><span class="sc">\\</span><span class="st">d{3}&quot;</span>, <span class="st">&quot;&quot;</span>,</span>
<span id="cb15-8"><a href="parsing-data.html#cb15-8" tabindex="-1"></a>                         <span class="at">ignore.case =</span> T,period)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="parsing-data.html#cb15-9" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;^-</span><span class="sc">\\</span><span class="st">d{4}&quot;</span>, <span class="st">&quot;&quot;</span>,<span class="at">ignore.case =</span> T,period)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="parsing-data.html#cb15-10" tabindex="-1"></a>    <span class="fu">separate</span>(period, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;quarter&quot;</span>, <span class="st">&quot;year&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>) </span>
<span id="cb15-11"><a href="parsing-data.html#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="parsing-data.html#cb15-12" tabindex="-1"></a>res <span class="sc">%&gt;%</span> <span class="fu">tail</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 14
##   postcode dwt   beds       wklyrent_q1 wklyrent_q2 wklyrent_q3 newbonds bondnum
##      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1     4390 House Total               NA          NA          NA       NA      NA
## 2     4390 House 4 or more~          NA          NA          NA       NA      NA
## 3     5341 Total Total               NA          NA          NA       NA      NA
## 4     5341 Total Not Speci~          NA          NA          NA       NA      NA
## 5     5341 Other Total               NA          NA          NA       NA      NA
## 6     5341 Other Not Speci~          NA          NA          NA       NA      NA
## # ... with 6 more variables: rentchgqrt &lt;dbl&gt;, rentchgann &lt;dbl&gt;,
## #   bondchgqrt &lt;dbl&gt;, bondchgann &lt;dbl&gt;, quarter &lt;chr&gt;, year &lt;chr&gt;</code></pre>
<p>Many postcodes have no data for weekly rental cost due either to no new rent contracts or small sample size. We can remove these from the dataset. Here, we use <code>rowSums</code> to count the total number of rows that has <code>NA</code> value and keep only rows where count of <code>NA</code> is smaller than 8.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="parsing-data.html#cb17-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="parsing-data.html#cb17-2" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">rowSums</span>(<span class="fu">is.na</span>(.)) <span class="sc">&lt;</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="parsing-data.html#cb17-3" tabindex="-1"></a>    <span class="fu">filter</span>(dwt <span class="sc">!=</span> <span class="st">&quot;Total&quot;</span> <span class="sc">&amp;</span> beds <span class="sc">!=</span> <span class="st">&quot;Total&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="parsing-data.html#cb18-1" tabindex="-1"></a>selacc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1 Bedroom&quot;</span>, <span class="st">&quot;2 Bedrooms&quot;</span>,<span class="st">&quot;3 Bedrooms&quot;</span>, <span class="st">&quot;4 or more Bedrooms&quot;</span>)</span>
<span id="cb18-2"><a href="parsing-data.html#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="parsing-data.html#cb18-3" tabindex="-1"></a>res <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="parsing-data.html#cb18-4" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^2&quot;</span>, postcode)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="parsing-data.html#cb18-5" tabindex="-1"></a>    <span class="fu">select</span>(postcode, quarter, year, dwt, beds, wklyrent_q2) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="parsing-data.html#cb18-6" tabindex="-1"></a>    <span class="fu">filter</span>(beds <span class="sc">%in%</span> selacc) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="parsing-data.html#cb18-7" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">substr</span>(quarter, <span class="dv">1</span>,<span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="parsing-data.html#cb18-8" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dt2 =</span> <span class="fu">paste0</span>(year,<span class="st">&quot;-&quot;</span>, quarter, <span class="st">&quot;-01&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="parsing-data.html#cb18-9" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">qrt =</span> <span class="fu">paste0</span>(month,<span class="fu">substr</span>(year,<span class="dv">3</span>,<span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="parsing-data.html#cb18-10" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dt =</span> <span class="fu">as.Date</span>(dt2, <span class="at">format =</span> <span class="st">&quot;%Y-%B-%d&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-11"><a href="parsing-data.html#cb18-11" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(wklyrent_q2)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href="parsing-data.html#cb18-12" tabindex="-1"></a>    <span class="fu">select</span>(postcode, dt, qrt, dwt, beds, wklyrent_q2) <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="parsing-data.html#cb18-13" tabindex="-1"></a>    <span class="fu">arrange</span>(dt) <span class="sc">%&gt;%</span> <span class="co">#group_by(qrt) %&gt;% summarise(n = n())</span></span>
<span id="cb18-14"><a href="parsing-data.html#cb18-14" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">&quot;postcode&quot;</span>, <span class="st">&quot;dwt&quot;</span>, <span class="st">&quot;beds&quot;</span>), </span>
<span id="cb18-15"><a href="parsing-data.html#cb18-15" tabindex="-1"></a>                <span class="at">names_from =</span> <span class="st">&quot;qrt&quot;</span>, </span>
<span id="cb18-16"><a href="parsing-data.html#cb18-16" tabindex="-1"></a>                <span class="at">values_from =</span> <span class="st">&quot;wklyrent_q2&quot;</span>, </span>
<span id="cb18-17"><a href="parsing-data.html#cb18-17" tabindex="-1"></a>                <span class="at">values_fill =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-18"><a href="parsing-data.html#cb18-18" tabindex="-1"></a>    <span class="fu">unnest</span>() <span class="co"># to unnest the df within each column.</span></span></code></pre></div>
<pre><code>## Warning: Values are not uniquely identified; output will contain list-cols.
## * Use `values_fn = list` to suppress this warning.
## * Use `values_fn = length` to identify where the duplicates arise
## * Use `values_fn = {summary_fun}` to summarise duplicates</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(Mar19, Jun19, Sep19, Dec19, Mar20, Jun20, Sep20, Dec20, Mar21, 
##     Jun21, sep21, dec21, Mar22, Jun22, Sep22, Dec22, Mar23, Jun23, 
##     Sep23)`</code></pre>
<pre><code>## # A tibble: 2,241 x 22
##    postcode dwt     beds   Mar19 Jun19 Sep19 Dec19 Mar20 Jun20 Sep20 Dec20 Mar21
##       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     2000 House   2 Bed~   850    NA    NA    NA    NA    NA   700   670   725
##  2     2000 Other   1 Bed~   575   605   605   589   619   589   499   499   504
##  3     2000 Other   2 Bed~   850    NA   950    NA    NA    NA   715   575    NA
##  4     2000 Flat/U~ 1 Bed~   660   670   650   650   660   525   500   490   550
##  5     2000 Flat/U~ 2 Bed~   940   915   900   880   935   750   705   670   750
##  6     2000 Flat/U~ 3 Bed~  1300  1380  1275  1400  1475  1025   970   905  1000
##  7     2007 Other   1 Bed~   419   345   409   395   395    NA   485   485   243
##  8     2007 Flat/U~ 1 Bed~   550   560   510   555   550   450   450   420   450
##  9     2007 Flat/U~ 2 Bed~   750   780   670   890   778   600   600   565   560
## 10     2008 House   2 Bed~   730   730   710    NA    NA   680   610   615   700
## # ... with 2,231 more rows, and 10 more variables: Jun21 &lt;dbl&gt;, sep21 &lt;dbl&gt;,
## #   dec21 &lt;dbl&gt;, Mar22 &lt;dbl&gt;, Jun22 &lt;dbl&gt;, Sep22 &lt;dbl&gt;, Dec22 &lt;dbl&gt;,
## #   Mar23 &lt;dbl&gt;, Jun23 &lt;dbl&gt;, Sep23 &lt;dbl&gt;</code></pre>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="setup.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="write.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jules32/bookdown-tutorial/edit/master/setup.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
